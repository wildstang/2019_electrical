#include "QTRSensors.h"

QTRSensorsRC qtrrc((unsigned char[]) {23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53}, 16);


unsigned int sensorValues[16];
unsigned char valuesToReturn[16];

int initLoop = 0;

void setup() 
{
  Serial.begin(9600);
  Serial.print("test\n");
  qtrrc.emittersOn(); qtrrc.calibrate();
  qtrrc.read(sensorValues);
}

void loop() 
{  
  qtrrc.read(sensorValues);  
  
  for(int i = 0; i < 16; i++) 
  {
    unsigned char valueToStore = sensorValues[i] / 1000;
    if(valueToStore < 128) 
	{
      valuesToReturn[i] = valueToStore;
    }
    else 
	{
      valuesToReturn[i] = 127;
    }
  }
  
  valuesToReturn[0] = valuesToReturn[0] | 0x80;

  //for(int i = 0; i < 16; i ++) {
    //Serial.print(i);
    //Serial.print(" ");
    //Serial.print(valuesToReturn[i]);
    //Serial.print("\n");
  //}

  //delay(2000);
  
  Serial.write(valuesToReturn, 16);
}
